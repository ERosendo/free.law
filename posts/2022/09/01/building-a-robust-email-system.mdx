---
title: "Building a Robust Email System for CourtListener Alerts and Emails"
date: "2022-09-01"
tags:
 - "Email"
 - "AWS"
 - "@recap.email"
 - "Reliability Engineering"
author: "Michael Lissner"
excerpt: "In this post, we explain how we've designed our email system to be as robust and reliable as possible."
---

<p class="lead">Earlier this week, <a href="/2022/08/26/personal-recap-dot-email-addresses/">we announced personalized @recap.email addresses</a> for all our users. In the announcement, we noted that one reason to use @recap.email is that it can make it more likely you'll get a notification about a filing.
</p>

This technical post explains the huge technical investments we've made to set up the most reliable email delivery system possible. Because it's a crisis when emails don't go through, we've gone the extra mile to make sure ours do.

One way to send emails is to run an email server yourself. This means that you install some software (e.g. `postfix`), and when you want to send an email, you tell that software to send it for you. That software connects to recipient servers and hands off the email to them.

On the surface it's pretty simple, but the Internet [has gotten complicated since the invention of email][atwood], and spammers have upped their game.

These days, if you want your emails to get to their destinations, there are a lot of things to think about. Among them:

1. To avoid spam filters, your server needs to check a number of boxes that prove it's legit. These include a mishmash of acronyms like SPF, DKIM, DMARC, and rDNS. Getting these right is hard.

2. Your domain name needs to have a good reputation. If you send lots of spam or even if you send emails to dead inboxes, your reputation gets damaged. Even emails you send to good inboxes will start getting marked as spam.

3. Your server needs to be up and needs to scale. If it crashes or can't keep up with traffic, well, the email won't go through.

4. The recipient servers need to be up. If they crash, the email won't go through either. We can't control this, but we can handle it.

It's a lot to think about, but because legal notifications are so important, we've invested heavily in getting it right.


## How we make sure you get our emails

The core of our email system uses [AWS Simple Email Service (SES)][ses] to send emails. SES takes care of a lot of the issues above. It's scalable, reliable, and has settings to make sure you don't have issues with the mishmash of acronyms.

Using SES is a great way to send emails, but we take it further:

1. **We resend failed emails.** If we discover that your inbox is full, your server is offline, or has another issue, we use an exponential backoff algorithm to try again later.

    While we wait for your inbox to be fixed, we save any new emails we'd normally send you. As soon as we detect that your inbox is fixed, we send you the emails you would have normally missed.

2. **We alert you if your account has an issue.** If we find that your email address is experiencing a temporary problem, we pop up a banner in CourtListener letting you know that there is an issue with your inbox, and we'll continue trying again.

    If we find that your email address no longer works, the banner in CourtListener strongly encourages you to update your email address to continue receiving emails from us:

    ![A screenshot showing a warrning banner that reads, "We are currently unable to send emails to you. Please update your email address to continue receiving emails."](/images/flagged-email.png)

3. **We carefully monitor our bounce notifications.** When emails to a particular address start bouncing, we have to stop sending is emails or else our reputation gets damaged. By monitoring our bounce notifications, we can flag dead addresses and stop sending messages to those recipients.

As you can see, email is a deceptively complicated topic. Since we [first launched CourtListener in 2010][cl], we have sent millions of legal alerts to our users, and we have invested deeply in our email infrastructure so it is robust and reliable.

We hope that by sharing our experience and the features of our design, other organizations can improve and innovate their systems too. As always, [our code is available][cl-code], and for this project, we even spent time [upgrading the Django-SES library][dses] that many organizations rely on.

It's always important that email work well, but when legal alerts are involved, there's no room for errors or shortcuts.


[atwood]: https://blog.codinghorror.com/so-youd-like-to-send-some-email-through-code/
[ses]: https://aws.amazon.com/ses/
[cl]: /2010/05/01/announcing-courtlistener-com/
[dses]: https://github.com/django-ses/django-ses/pull/239
[cl-code]: https://github.com/freelawproject/courtlistener/blob/main/cl/lib/email_backends.py